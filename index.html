<!DOCTYPE html>
<html>
<head>
	<title>Axios e Funções</title>
	<meta charset="utf-8">
	<meta name="theme-color" content="#54bc97">
	<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">	
	<style type="text/css">
	
		body {
		    color: #ffffff;
		    background-color: #54bc97;
		    background-image: url("img.jpg");			
			background-repeat: no-repeat;
			background-size: contain;
		    font-family: arial;
		    padding-top: 250px;
		}

		h1, h4 {
			color: #e5f62c;
		}

		select {
			width: 80px;
			margin-left: 10px;		
		}

		@media screen and (min-width: 681px) {
			.row {
				display: flex;		
				width: 100%;
			}

			body {
				background-size: auto;
				padding: 500px 100px 0 100px;				
				margin: auto;
			}

			.row .grafico{		
				width: 40%;
				margin: auto;
			}
		}

		@media screen and (max-width: 999px) {
			.row {
				display: block;		
				width: 100%;
			}

			.row .grafico{		
				width: 100%;
				margin: auto;
			}
		}

	</style>
</head>

<body class="bg-dark">
	<div class="container">		
		<h1>Axios e Funções</h1>
		<hr>
		<div class="form-group w-50 my-3">
			<label style="font-weight: bold;">Quantidade de dias: </label>
			<select class="form-control">
				<option value="7">7</option>
				<option value="15">15</option>
				<option value="30">30</option>
				<option value="60">60</option>
				<option value="120">120</option>
				<option value="240">240</option>
				<option value="360">360</option>
			</select>
		</div>
		<hr>
		<div class="row">
			<div class=" grafico">
				<h4>Dólar (USD)</h4>
				<div id="chart_div1"></div>
			</div>
			<div class=" grafico">
				<h4>Euro (EUR)</h4>
				<div id="chart_div2"></div>
			</div>
		</div>
		<div class="row">
			<div class=" grafico">
				<h4>BitCoin (BTC)</h4>
				<div id="chart_div3"></div>
			</div>
			<div class=" grafico">
				<h4>Dólar Canadense (CAD)</h4>
				<div id="chart_div4"></div>
			</div>
		</div>		
		<hr>
		<small><b>Fonte: https://economia.awesomeapi.com.br</b></small>
	</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script type="text/javascript">
	let div_chart1 = document.querySelector("#chart_div1");
	let div_chart2 = document.querySelector("#chart_div2");
	let div_chart3 = document.querySelector("#chart_div3");
	let div_chart4 = document.querySelector("#chart_div4");	

	let select = document.querySelector("select");
	let dias = select.value;
	
	select.addEventListener("change", () => {
		dias = document.querySelector("select").value;
		getValues("USD", div_chart1);
		getValues("EUR", div_chart2);
		getValues("BTC", div_chart3);
		getValues("CAD", div_chart4);
	
	})

	function getValues(moeda, div) {
		axios.get(`https://economia.awesomeapi.com.br/json/daily/${moeda}-BRL/${dias}`)
    		.then(function (response) {
          let valores = [];
    			let i = response.data.length;
    			for (dado of response.data){
    				valores.push([i, parseFloat(dado.high)]);
    				i--;
    			}
    			createChart(moeda, valores, div);
      		})
    
      		.catch(function (error) {
    		    alert(error);
    		})
	}

	function createChart(moeda, valores, div) {
		google.charts.load('current', {packages: ['corechart', 'line']});
		google.charts.setOnLoadCallback(drawBackgroundColor);

		function drawBackgroundColor() {
			let data = new google.visualization.DataTable();
			data.addColumn('number', 'R$');
			data.addColumn('number', 'Valor');

			data.addRows(valores);

			let options = {
				height: 400,
				chartArea: {width: '70%', height: '80%'},
				legend: "none",
				title: `Variação do ${moeda} nos útimos ${dias} dias`,
				hAxis: {
					title: 'Dias',									
				},
				vAxis: {
					title: 'Reais',
					minValue: 0,
					maxValue: 7,					
				},
				backgroundColor: '#fff',
				colors: ["#ff0000"],
				lineWidth: 2,
			};

			let chart = new google.visualization.LineChart(div);
			chart.draw(data, options);
		}
	}
	
	getValues("USD", div_chart1);
	getValues("EUR", div_chart2);
	getValues("BTC", div_chart3);
	getValues("CAD", div_chart4);
				   
</script>
</body>
</html>
